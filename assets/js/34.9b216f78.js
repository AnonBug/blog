(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{323:function(s,t,a){s.exports=a.p+"assets/img/webpack01.a482ab80.jpg"},324:function(s,t,a){s.exports=a.p+"assets/img/webpack02.de51baab.jpg"},325:function(s,t,a){s.exports=a.p+"assets/img/webpack03.bd5028ab.jpg"},688:function(s,t,a){"use strict";a.r(t);var n=a(26),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"webpack-学习笔记"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#webpack-学习笔记"}},[s._v("#")]),s._v(" Webpack 学习笔记")]),s._v(" "),n("blockquote",[n("p",[n("a",{attrs:{href:"https://github.com/yuhaoju/webpack-config-handbook",target:"_blank",rel:"noopener noreferrer"}},[s._v("《"),n("strong",[s._v("Webpack 实战（入门，进阶与调优）")]),s._v("》"),n("OutboundLink")],1)])]),s._v(" "),n("p",[s._v("本质上，webpack 是一个现代 JavaScript 应用程序的静态模块打包器(module bundler)。")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://www.webpackjs.com/concepts/",target:"_blank",rel:"noopener noreferrer"}},[s._v("webpack"),n("OutboundLink")],1),s._v("的配置浩如烟海，听说有的单位甚至有 webpack 配置工程师专门负责这块内容。")]),s._v(" "),n("p",[s._v("本着把工具看作黑盒，只学习如何配置、如何使用的原则，记录初始使用 webpack 的情况如下。")]),s._v(" "),n("h2",{attrs:{id:"_1-基本概念"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-基本概念"}},[s._v("#")]),s._v(" 1. 基本概念")]),s._v(" "),n("p",[s._v("用 webpack 官网的宣传图，其作用就是打包：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(323),alt:""}})]),s._v(" "),n("p",[s._v("webpack 世界里，一张图片、一个 css 、一个 js 、一个 font 等等所有东西都是模块（Module），其中存在着互相引用的依赖关系。 webpack 就是处理这些模块间的依赖关系，并将其打包。对于不同的模块，webpack 使用不同的"),n("strong",[s._v("加载器")]),s._v("进行处理。")]),s._v(" "),n("p",[s._v("其主要适用场景是当下流行的单页面应用（SPA），由一个 html 文件 和一堆按需加载的 js 、css 等组成。")]),s._v(" "),n("h3",{attrs:{id:"_1-1-webpack-构建流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-webpack-构建流程"}},[s._v("#")]),s._v(" 1.1 webpack 构建流程")]),s._v(" "),n("p",[n("img",{attrs:{src:a(324),alt:""}})]),s._v(" "),n("ol",[n("li",[s._v("初始化：读取配置，加载插件，实例化编译器")]),s._v(" "),n("li",[s._v("从 entry 出发，针对每个 module 调用对应的 Loader 编译内容，对 module 依赖的 module 进行递归处理；")]),s._v(" "),n("li",[s._v("将编译后的 module 组装成 Chunk ，将 chunk 转换为文件，输出到指定位置")]),s._v(" "),n("li",[s._v("在以上过程中， webpack 在特定时间节点抛出特定事件， plugins 在监听到相应事件后执行逻辑，改变 webpack 的运行结果。")])]),s._v(" "),n("h2",{attrs:{id:"_2-webpack-配置-四大件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-webpack-配置-四大件"}},[s._v("#")]),s._v(" 2. Webpack 配置（四大件）")]),s._v(" "),n("p",[n("strong",[s._v("归根到底， webpack 就是一个 .js 配置文件。")])]),s._v(" "),n("p",[s._v("随着需求的出现，工程配置逐渐完善。")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ./build/webpack.config.js")]),s._v("\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 在这里书写配置")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ./package.json")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"script"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dev"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"webpack-dev-server --config build/webpack.config.js"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("以上配置之后，当执行 "),n("code",[s._v("npm run dev")]),s._v(" 时，就会开始打包构建，其配置文件就是 "),n("code",[s._v("--config")]),s._v("后面提供的 js 地址。")]),s._v(" "),n("p",[s._v("webpack-dev-server 的其他命令")]),s._v(" "),n("ul",[n("li",[s._v("--open：自动在浏览器打开页面，默认地址是 127.0.0.1:8080")])]),s._v(" "),n("p",[n("strong",[s._v("webpack-dev-server 同时提供一项热更新功能，通过建立一个 websocket 连接来实时响应代码的修改")]),s._v("。")]),s._v(" "),n("h3",{attrs:{id:"_2-1-入口"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-入口"}},[s._v("#")]),s._v(" 2.1 "),n("strong",[s._v("入口")])]),s._v(" "),n("p",[s._v("入口的作用是告诉 webpack 从哪里开始寻找依赖。")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[s._v("module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    entry"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 寻找根目录下的 main.js 作为依赖入口")]),s._v("\n        main"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./main'")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"_2-2-出口"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-出口"}},[s._v("#")]),s._v(" 2.2 "),n("strong",[s._v("出口")])]),s._v(" "),n("p",[s._v("出口用来配置编译后的文件存储位置及文件名。")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" path "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'path'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    output"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// __dirname 是当前模块所在的目录（来自 nodejs api）")]),s._v("\n        path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__dirname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./dist'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// publicPath 指定资源文件引用的目录")]),s._v("\n        publicPath"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/dist/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 指定输出文件的名称")]),s._v("\n        filename"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'main.js'")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("按照以上配置，打包后的文件会存储为 build/dist/main.js 。")]),s._v(" "),n("h3",{attrs:{id:"_2-3-加载器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-加载器"}},[s._v("#")]),s._v(" 2.3 "),n("strong",[s._v("加载器")])]),s._v(" "),n("blockquote",[n("p",[s._v('loader 用于对模块的源代码进行转换。loader 可以使你在 import 或"加载"模块时预处理文件。因此，loader 类似于其他构建工具中“任务(task)”，并提供了处理前端构建步骤的强大方法。loader 可以将文件从不同的语言（如 TypeScript）转换为 JavaScript，或将内联图像转换为 data URL。loader 甚至允许你直接在 JavaScript 模块中 import CSS文件！')])]),s._v(" "),n("p",[s._v("loader 让 webpack 能够去处理那些非 JavaScript 文件（webpack 自身只理解 JavaScript）。loader 可以将所有类型的文件转换为 webpack 能够处理的有效模块，然后你就可以利用 webpack 的打包能力，对它们进行处理。")]),s._v(" "),n("p",[s._v("Loader 本质就是一个函数，在该函数中对接收到的内容进行转换，返回转换后的结果。 因为 Webpack 只认识 JavaScript，所以 Loader 就成了翻译官，对其他类型的资源进行转译的预处理工作。")]),s._v(" "),n("p",[n("strong",[s._v("遇到非js结尾的模块，webpack会去module中找相应的规则，匹配到了对于的规则，然后去求助于对应的 loader 。")])]),s._v(" "),n("p",[s._v("以打包 css 样式为例：")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 安装加载器")]),s._v("\nnpm i css"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("loader "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("save"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dev\nnpm i style"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("loader "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("save"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dev\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ./build/webpack.config.js")]),s._v("\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    module"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        rules"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                test"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token regex"}},[n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("\\.css$")]),n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                use"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'style-loader'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'css-loader'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("在 module.rules 中指定 loader ，每个 loader 都必须包括 test 和 use 选项。 test 使用正则表达式判断该文件类型是否需要使用 use 配置的 loaders 处理。")]),s._v(" "),n("p",[s._v("如果 use 配置了多个 loader （例如以上情况），则处理顺序为自右向左，即先由 css-loader 处理完后，再交给 style-loader 处理。")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://www.webpackjs.com/loaders/",target:"_blank",rel:"noopener noreferrer"}},[s._v("这里"),n("OutboundLink")],1),s._v("官方提供了一些加载器列表和相关用法。")]),s._v(" "),n("h3",{attrs:{id:"_2-4-插件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-插件"}},[s._v("#")]),s._v(" 2.4 "),n("strong",[s._v("插件")])]),s._v(" "),n("blockquote",[n("p",[s._v("插件是 webpack 的支柱功能。webpack 自身也是构建于，你在 webpack 配置中用到的相同的插件系统之上！")]),s._v(" "),n("p",[s._v("插件目的在于解决 loader 无法实现的其他事。")])]),s._v(" "),n("p",[s._v("loader 被用于转换某些类型的模块，而插件则可以用于执行范围更广的任务。插件的范围包括，从打包优化和压缩，一直到重新定义环境中的变量。")]),s._v(" "),n("p",[s._v("Plugin 就是插件，基于事件流框架 Tapable，插件可以扩展 Webpack 的功能，在 Webpack 运行的生命周期中会广播出许多事件，Plugin 可以监听这些事件，在合适的时机通过 Webpack 提供的 API 改变输出结果。")]),s._v(" "),n("p",[s._v("譬如，项目希望把所有的 css 提取出来，生成一个总的 main.css 文件，需要如下实现：")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 安装 extract-text-webpack-plugin 插件")]),s._v("\nnpm i extract"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("text"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("webpack"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("plugin@next "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("save"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dev\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ./build/webpack.config.js")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" ExtractTextPlugin "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'extract-text-webpack-plugin'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    module"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        rules"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            test"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token regex"}},[n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("\\.css$")]),n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 使用插件改写 use")]),s._v("\n            use"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" ExtractTextPlugin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("extract")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                use"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'css-loader'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                fallback"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'style-loader'")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    plugins"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 重命名提取后的 css 文件")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExtractTextPlugin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'main.css'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("h2",{attrs:{id:"_3-深入-loader"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-深入-loader"}},[s._v("#")]),s._v(" 3. 深入 loader")]),s._v(" "),n("p",[s._v("所谓 "),n("code",[s._v("loader")]),s._v(" 只是一个导出为函数的 "),n("code",[s._v("JavaScript")]),s._v(" 模块，函数的 "),n("code",[s._v("this")]),s._v(" 上下文将由 "),n("code",[s._v("webpack")]),s._v(" 填充。")]),s._v(" "),n("p",[s._v("其实际功能更像一个"),n("strong",[s._v("预处理器")]),s._v("—— "),n("code",[s._v("Webpack")]),s._v(" 只认识 "),n("code",[s._v("JavaScript")]),s._v(" ，对于其他类型的资源，需要通过预定义的 "),n("code",[s._v("loader")]),s._v(" 进行转译，输出为 "),n("code",[s._v("Webpack")]),s._v(" 能够接收的形式。")]),s._v(" "),n("h3",{attrs:{id:"主要配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#主要配置"}},[s._v("#")]),s._v(" 主要配置")]),s._v(" "),n("p",[n("code",[s._v("loader")]),s._v(" 规则定义在配置文件的 "),n("code",[s._v("module")]),s._v(" 配置下：")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// webpack.config.js")]),s._v("\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    module"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        rules"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 定义 loader 和对应文件类型等配置")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("table",[n("thead",[n("tr",[n("th",[s._v("配置")]),s._v(" "),n("th",[s._v("说明")]),s._v(" "),n("th",[s._v("参数")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("exclude")]),s._v(" "),n("td",[s._v("排除指定目录下的模块")]),s._v(" "),n("td",[s._v("正则")])]),s._v(" "),n("tr",[n("td",[s._v("include")]),s._v(" "),n("td",[s._v("包含指定目录下的模块（优先级：exclude > include）")]),s._v(" "),n("td",[s._v("正则")])]),s._v(" "),n("tr",[n("td",[s._v("resource")]),s._v(" "),n("td",[s._v("被加载的模块")]),s._v(" "),n("td",[s._v("相关配置")])]),s._v(" "),n("tr",[n("td",[s._v("issuer")]),s._v(" "),n("td",[s._v("加载者")]),s._v(" "),n("td",[s._v("相关配置")])])])]),s._v(" "),n("h3",{attrs:{id:"常用-loader"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常用-loader"}},[s._v("#")]),s._v(" 常用 loader")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("loader")]),s._v(" "),n("th",[s._v("功能说明")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("babel-loader")]),s._v(" "),n("td",[s._v("将 es6 语法转译为 es5")])]),s._v(" "),n("tr",[n("td",[s._v("file-loader")]),s._v(" "),n("td",[s._v("打包文件类资源，并返回其 publicPath (资源引用路径)")])]),s._v(" "),n("tr",[n("td",[s._v("url-loader")]),s._v(" "),n("td",[s._v("打包文件类资源，当文件大小超过阈值时，使用 base64 编码")])]),s._v(" "),n("tr",[n("td",[s._v("vue-loader")]),s._v(" "),n("td",[s._v("打包 vue 组件")])])])]),s._v(" "),n("h3",{attrs:{id:"自定义-loader"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#自定义-loader"}},[s._v("#")]),s._v(" 自定义 loader")]),s._v(" "),n("p",[s._v("loader 本质上就是一个导出的函数：")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// my-custom-loader.js")]),s._v("\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("exports")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("content")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 自定义的 loader ，为所有 js 文件添加严格模式")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'use strict';\\n\\n")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("content"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("此外，还可以通过 "),n("code",[s._v("webpack.config.js")]),s._v(" 向其传递 "),n("code",[s._v("options")]),s._v(" ，以及使用 "),n("code",[s._v("webpack")]),s._v(" 添加在 "),n("code",[s._v("this")]),s._v(" 上下文中的对象和函数（参见"),n("a",{attrs:{href:"https://www.webpackjs.com/api/loaders/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),n("OutboundLink")],1),s._v("）。")]),s._v(" "),n("h2",{attrs:{id:"_4-样式处理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-样式处理"}},[s._v("#")]),s._v(" 4. 样式处理")]),s._v(" "),n("p",[s._v("样式内容有两种方式引入到项目文件中：")]),s._v(" "),n("ul",[n("li",[s._v("直接插入 style 标签")]),s._v(" "),n("li",[s._v("提取到单独的 CSS 文件，通过 link 标签引入")])]),s._v(" "),n("p",[s._v("对于第二种方式，通过插件包装后的 loader 实现：")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// webpack.config.js")]),s._v("\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    module"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        rules"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                test"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token regex"}},[n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v(".\\css$")]),n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                use"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" ExtractTextPlugin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("extract")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    fallback"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'style-loader'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                    use"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'css-loader'")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n    plugins"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExtractTextPlugin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'bundle.css'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[s._v("通过以上配置， css 内容会在经过 "),n("code",[s._v("css-loader")]),s._v(" 和 "),n("code",[s._v("style-loader")]),s._v(" 的处理后，保存为 "),n("code",[s._v("bundle.css")]),s._v(" 文件。")]),s._v(" "),n("h3",{attrs:{id:"_4-1-css-模块化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-css-模块化"}},[s._v("#")]),s._v(" 4.1 CSS 模块化")]),s._v(" "),n("p",[s._v("启用 css-loader 的 modules 配置项即可。")]),s._v(" "),n("h3",{attrs:{id:"_4-2-可用的一些工具"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-可用的一些工具"}},[s._v("#")]),s._v(" 4.2 可用的一些工具")]),s._v(" "),n("ul",[n("li",[s._v("插件\n"),n("ul",[n("li",[s._v("extract-text-webpack-plugin")]),s._v(" "),n("li",[s._v("mini-css-extract-plugin")])])]),s._v(" "),n("li",[s._v("样式预处理\n"),n("ul",[n("li",[s._v("Sass/SCSS")]),s._v(" "),n("li",[s._v("Less")]),s._v(" "),n("li",[s._v("PostCSS")])])]),s._v(" "),n("li",[s._v("样式检测\n"),n("ul",[n("li",[s._v("stylelint")])])])]),s._v(" "),n("h2",{attrs:{id:"_5-代码分片"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-代码分片"}},[s._v("#")]),s._v(" 5. 代码分片")]),s._v(" "),n("blockquote",[n("p",[s._v("实现高性能应用的重要一点是，"),n("strong",[s._v("让用户每次只加载必要的资源，优先级不太高的资源可以采用延迟加载等技术渐进式地获取")]),s._v("。")])]),s._v(" "),n("p",[s._v("代码分片有如下好处：")]),s._v(" "),n("ul",[n("li",[s._v("合理的分片可以有效利用客户端缓存")])]),s._v(" "),n("h3",{attrs:{id:"_5-1-通过入口划分"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-通过入口划分"}},[s._v("#")]),s._v(" 5.1 通过入口划分")]),s._v(" "),n("p",[s._v("通过定义多入口，可以将代码提取到不同的文件中，应用场景如下：")]),s._v(" "),n("ul",[n("li",[s._v("单页面应用中，可以额外设置一个 lib 入口，存放不常更新的库资源")]),s._v(" "),n("li",[s._v("多页面应用，为每个页面创建一个入口")])]),s._v(" "),n("h3",{attrs:{id:"_5-2-提取公共文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-提取公共文件"}},[s._v("#")]),s._v(" 5.2 提取公共文件")]),s._v(" "),n("p",[s._v("使用 "),n("code",[s._v("CommonsChunkPlugin")]),s._v(" / "),n("code",[s._v("SplitChunks")]),s._v(" 插件，将多个 chunk 的公共部分提取出来。")]),s._v(" "),n("p",[s._v("提取公共 chunk 有以下好处：")]),s._v(" "),n("ul",[n("li",[s._v("减少重复模块的打包时间")]),s._v(" "),n("li",[s._v("减小整体资源体积")])]),s._v(" "),n("h3",{attrs:{id:"_5-3-资源的异步加载"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-资源的异步加载"}},[s._v("#")]),s._v(" 5.3 资源的异步加载")]),s._v(" "),n("p",[s._v("异步加载通过把暂时用不到的模块延迟加载，使页面初次渲染时所需资源尽可能少，后续模块等待恰当的时机再加载。")]),s._v(" "),n("p",[s._v("webpack 提供了一个 import 函数进行模块及其依赖的异步加载：")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// a.js")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" a "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" b\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// b.js")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("needLoad"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('/* webpackChunkName: "a-chunk-name" */')]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./a.js'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("add"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("如上，当时机合适，模块 a 才会被加载。在打包时， a 被打包为独立模块，可以在 import 函数的注释对 a 模块进行命名。")]),s._v(" "),n("p",[s._v("a 模块属于项目的间接资源，其存储在 "),n("code",[s._v("output.publicPath")]),s._v(" 路径下。")]),s._v(" "),n("h2",{attrs:{id:"_6-生产环境配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-生产环境配置"}},[s._v("#")]),s._v(" 6. 生产环境配置")]),s._v(" "),n("p",[s._v("当在 webpack 配置中开启生产环境， webpack 会自动添加许多适用于生产环境的配置项，减少人为手动的操作。")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// webpack.config.js")]),s._v("\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    mode"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'production'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h3",{attrs:{id:"_6-1-source-map-配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-source-map-配置"}},[s._v("#")]),s._v(" 6.1 source map 配置")]),s._v(" "),n("p",[s._v("source map 是将编译、打包、压缩后的代码映射回源代码的过程，对于 debugger 有很大帮助。")]),s._v(" "),n("p",[s._v("开启 source map 是配置 devtool 项。")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// webpack.config.js")]),s._v("\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    devtool"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'source-map'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("在生成 bundle 文件时，会同时生成 map 文件，并在 bundle 文件中追加一句注释标识 map 文件的地址。")]),s._v(" "),n("p",[s._v("当使用 F12 打开浏览器开发者工具时， map 文件会同时被加载，然后浏览器使用它来对打包后的 bundle 文件进行解析，分析出源代码的目录结构与内容。")]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),n("p",[s._v("map 文件可能很大，但只要不开启开发者工具，浏览器是不会加载的，对于普通用户没有影响。")])]),s._v(" "),n("p",[s._v("尽管 source-map 不会影响用户的浏览体验，但是会带来安全问题，所有人都可能通过开发者工具查看到源代码。")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("配置项")]),s._v(" "),n("th",[s._v("说明")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("source-map")]),s._v(" "),n("td",[s._v("完整的 map 文件和引用，任何人都可以查看源代码")])]),s._v(" "),n("tr",[n("td",[s._v("hidden-source-map")]),s._v(" "),n("td",[s._v("有完整 map 文件，但不在 bundle 中添加引用地址，需要利用第三方服务（如Sentry）托管 map 文件")])]),s._v(" "),n("tr",[n("td",[s._v("nosources-source-map")]),s._v(" "),n("td",[s._v("可以看到源码目录结构，但文件内容被隐藏，可以看到错误栈或行数")])])])]),s._v(" "),n("p",[s._v("另一种方式是通过配置 nginx 服务器，将 .map 文件只对固定白名单（如公司内网）开放，方便调试的同时，也保证了安全性。")]),s._v(" "),n("h3",{attrs:{id:"_6-2-资源压缩"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-资源压缩"}},[s._v("#")]),s._v(" 6.2 资源压缩")]),s._v(" "),n("p",[s._v("当设置为生产环境，代码压缩是默认配置。")]),s._v(" "),n("p",[s._v("使用的是 terser-webpack-plugin 插件。")]),s._v(" "),n("h3",{attrs:{id:"_6-3-缓存"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-缓存"}},[s._v("#")]),s._v(" 6.3 缓存")]),s._v(" "),n("p",[s._v("缓存是浏览器重复使用已经获取过的资源，以减少网络请求，缓解带宽压力，提高浏览体验。")]),s._v(" "),n("p",[s._v("具体的缓存策略由服务器决定，浏览器会在资源过期前使用本地缓存进行响应。")]),s._v(" "),n("p",[s._v("为保证用户及时获取到最新资源，需要为文件名添加 hash 值以保证更新。")]),s._v(" "),n("h2",{attrs:{id:"_7-打包优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-打包优化"}},[s._v("#")]),s._v(" 7. 打包优化")]),s._v(" "),n("p",[s._v("关于优化的一条经验之谈是："),n("strong",[s._v("不要过早优化")]),s._v("。")]),s._v(" "),n("p",[s._v("一般是当项目发展到一定规模，性能问题随之而来，再去分析和对症下药。")]),s._v(" "),n("h3",{attrs:{id:"_7-1-打包原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-打包原理"}},[s._v("#")]),s._v(" 7.1 打包原理")]),s._v(" "),n("ol",[n("li",[s._v("从配置中获取打包入口")]),s._v(" "),n("li",[s._v("配置 loader 规则，对入口模块进行转译")]),s._v(" "),n("li",[s._v("对转译后的模块进行依赖检索")]),s._v(" "),n("li",[s._v("对新找到的模块重复 2，3，直到没有新依赖")])]),s._v(" "),n("p",[s._v("步骤 2 和 3 是递归执行，由于 webpack 是单线程，所有模块必须依次执行转译（即使不存在依赖关系）。")]),s._v(" "),n("p",[s._v("通过 HappyPack 可以开启多个线程，并行转译操作，提高打包速度。")]),s._v(" "),n("h3",{attrs:{id:"_7-2-缩小打包作用域"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-缩小打包作用域"}},[s._v("#")]),s._v(" 7.2 缩小打包作用域")]),s._v(" "),n("p",[s._v("通过配置 rule 中的 include 和 exclude 项，提高打包精确度。")]),s._v(" "),n("h3",{attrs:{id:"_7-3-tree-shaking-摇树优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-tree-shaking-摇树优化"}},[s._v("#")]),s._v(" 7.3 tree shaking （摇树优化）")]),s._v(" "),n("p",[s._v("tree shaking 是在打包过程中进行代码检测，对于模块中那些没有被用到的部分，会被移除。")]),s._v(" "),n("p",[s._v("以下代码为例：")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// utils.js")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("fn1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("fn2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// index.js")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("fn1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" '"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("utils\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("fn1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("utils 模块有两个工具函数， index 只使用到 fn1 函数，把 utils 完全打包，就会有资源浪费。")]),s._v(" "),n("p",[s._v("webpack 提供的摇树优化，在打包时会对 fn2 函数添加一个标记，在进行生产环境打包时，将其移除（正常开发模式下依然存在）。")]),s._v(" "),n("p",[s._v("tree shaking 只能对 es6 模块生效。因为 es6 模块的依赖关系是在代码编译时构建的，而非运行时。")]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),n("p",[s._v("webpack 提供的 tree shaking 优化本身只是为死代码加上标记，真正去除死代码是通过压缩工具实现的。")])]),s._v(" "),n("h2",{attrs:{id:"_8-开发调优"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-开发调优"}},[s._v("#")]),s._v(" 8. 开发调优")]),s._v(" "),n("h3",{attrs:{id:"一些效率插件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一些效率插件"}},[s._v("#")]),s._v(" 一些效率插件")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("插件")]),s._v(" "),n("th",[s._v("作用")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("webpack-dashboard")]),s._v(" "),n("td",[s._v("优化控制台中的打包信息展示方式")])]),s._v(" "),n("tr",[n("td",[s._v("webpack-merge")]),s._v(" "),n("td",[s._v("合并 webpack 的配置文件")])]),s._v(" "),n("tr",[n("td",[s._v("speed-measure-webpack-plugin")]),s._v(" "),n("td",[s._v("输出 webpack 各个步骤的构建时间")])]),s._v(" "),n("tr",[n("td",[s._v("size-plugin")]),s._v(" "),n("td",[s._v("监控打包资源的体积变化")])])])]),s._v(" "),n("h2",{attrs:{id:"_9-模块热替换"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-模块热替换"}},[s._v("#")]),s._v(" 9. 模块热替换")]),s._v(" "),n("blockquote",[n("p",[n("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/30669007",target:"_blank",rel:"noopener noreferrer"}},[s._v("Webpack HMR 原理解析"),n("OutboundLink")],1),s._v(" "),n("a",{attrs:{href:"https://juejin.im/post/6844904094281236487",target:"_blank",rel:"noopener noreferrer"}},[s._v("再来一打Webpack面试题"),n("OutboundLink")],1)])]),s._v(" "),n("p",[s._v("在一般开发模式，是在调整代码后，手动更新构建项目，手动刷新页面，然后手动操作到更新的位置，以查看修改效果，然后再改代码。")]),s._v(" "),n("p",[s._v("后来，一些开发工具能够检测代码改动，然后自动构建，触发网页刷新，如 live-reload。")]),s._v(" "),n("p",[s._v("webpack 又进了一步，让代码在网页无刷新的情况下得到最新改动，即在"),n("strong",[s._v("保留页面当前状态的前提下呈现代码的最新改动")]),s._v("，这就是模块热替换功能（HMR）。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(325),alt:""}})]),s._v(" "),n("h3",{attrs:{id:"启动热替换模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#启动热替换模式"}},[s._v("#")]),s._v(" 启动热替换模式")]),s._v(" "),n("p",[s._v("要开启热替换功能，需要使用 webpack-dev-server 启动项目：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 webpack-dev-server 插件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" -D "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" webpack-dev-server\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 serve 模式构建和启动项目")]),s._v("\nwebpack serve\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("开启后，资源的体积比原本大了很多，因为 webpack 为了实现 HMR 注入了很多相关代码。")]),s._v(" "),n("h3",{attrs:{id:"何时拉取"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#何时拉取"}},[s._v("#")]),s._v(" 何时拉取")]),s._v(" "),n("ol",[n("li",[s._v("WDS（webpack-dev-server） 与浏览器之间维护了一个 websocket")]),s._v(" "),n("li",[s._v("当资源发生变化， WDS 向浏览器推送更新事件，并带上最新构建的 hash 值")]),s._v(" "),n("li",[s._v("客户端拿到构建 hash ，与上一次资源对比（因为源文件更新并不一定更改构建结果）")])]),s._v(" "),n("blockquote",[n("p",[s._v("live-reload 也是依赖这种实现的。")])]),s._v(" "),n("h3",{attrs:{id:"拉取什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#拉取什么"}},[s._v("#")]),s._v(" 拉取什么")]),s._v(" "),n("p",[s._v("当客户端知道发生了更新，会向 WDS 发起请求，获取"),n("strong",[s._v("更改文件的列表")]),s._v("。")]),s._v(" "),n("p",[s._v("客户端借助该列表，继续向 WDS 发起请求，获取更改文件的内容。")]),s._v(" "),n("h3",{attrs:{id:"如何更新"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何更新"}},[s._v("#")]),s._v(" 如何更新")]),s._v(" "),n("p",[s._v("客户端获取到了 chunk 更新，但应当如何处理这些更新，保留哪些状态，更新哪些状态，这需要开发者自行决定。")]),s._v(" "),n("p",[s._v("webpack 提供了相关 api ，帮助开发者在合适的契机进行状态的处理。")])])}),[],!1,null,null,null);t.default=e.exports}}]);