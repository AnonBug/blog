(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{444:function(s,t,a){s.exports=a.p+"assets/img/vue03.c5e586be.jpg"},445:function(s,t,a){s.exports=a.p+"assets/img/vue04.6198a18f.jpg"},446:function(s,t,a){s.exports=a.p+"assets/img/vue05.9d9c9c0b.jpg"},447:function(s,t,a){s.exports=a.p+"assets/img/vue06.40383679.jpg"},448:function(s,t,a){s.exports=a.p+"assets/img/vue07.58becaa3.jpg"},449:function(s,t,a){s.exports=a.p+"assets/img/vue08.fe939598.jpg"},450:function(s,t,a){s.exports=a.p+"assets/img/vue01.143a713f.jpg"},451:function(s,t,a){s.exports=a.p+"assets/img/vue02.c38f5eb6.jpg"},694:function(s,t,a){"use strict";a.r(t);var n=a(26),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"vue-项目部署遇到的那些问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vue-项目部署遇到的那些问题"}},[s._v("#")]),s._v(" vue 项目部署遇到的那些问题")]),s._v(" "),n("div",{staticClass:"diy-menu"},[n("p"),n("div",{staticClass:"table-of-contents"},[n("ul",[n("li",[n("a",{attrs:{href:"#_1-部署到-tomcat-服务器"}},[s._v("1. 部署到 tomcat 服务器")]),n("ul",[n("li",[n("a",{attrs:{href:"#_1-1-操作步骤"}},[s._v("1.1 操作步骤")])]),n("li",[n("a",{attrs:{href:"#_1-2-问题"}},[s._v("1.2 问题")])])])]),n("li",[n("a",{attrs:{href:"#_2-部署到-nginx-代理服务器"}},[s._v("2. 部署到 nginx 代理服务器")]),n("ul",[n("li",[n("a",{attrs:{href:"#_2-1-步骤"}},[s._v("2.1 步骤")])]),n("li",[n("a",{attrs:{href:"#_2-2-跨域配置"}},[s._v("2.2 跨域配置")])]),n("li",[n("a",{attrs:{href:"#_2-3-问题"}},[s._v("2.3 问题")])])])]),n("li",[n("a",{attrs:{href:"#_3-将项目部署到二级目录"}},[s._v("3. 将项目部署到二级目录")]),n("ul",[n("li",[n("a",{attrs:{href:"#_3-1-项目代码修改"}},[s._v("3.1 项目代码修改")])]),n("li",[n("a",{attrs:{href:"#_3-2-部署"}},[s._v("3.2 部署")])])])]),n("li",[n("a",{attrs:{href:"#附-其他坑"}},[s._v("附：其他坑")]),n("ul",[n("li",[n("a",{attrs:{href:"#部署中的路径问题"}},[s._v("部署中的路径问题")])]),n("li",[n("a",{attrs:{href:"#资源报错问题"}},[s._v("资源报错问题")])]),n("li",[n("a",{attrs:{href:"#正则表达式问题"}},[s._v("正则表达式问题")])]),n("li",[n("a",{attrs:{href:"#无法通过ip访问"}},[s._v("无法通过ip访问")])])])])])]),n("p")]),s._v(" "),n("h2",{attrs:{id:"_1-部署到-tomcat-服务器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-部署到-tomcat-服务器"}},[s._v("#")]),s._v(" 1. 部署到 tomcat 服务器")]),s._v(" "),n("p",[n("strong",[s._v("目标")]),s._v("：使用 localhost:8080 可直接访问项目")]),s._v(" "),n("h3",{attrs:{id:"_1-1-操作步骤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-操作步骤"}},[s._v("#")]),s._v(" 1.1 操作步骤")]),s._v(" "),n("ol",[n("li",[s._v("npm run build")])]),s._v(" "),n("p",[s._v("保持默认配置，打包项目，在项目根目录下的 dist 文件夹生成 static文件夹和 index.html 文件")]),s._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[s._v("将dist 文件夹下的内容拷贝到 tomcat 相应位置：\ntomcat/webapps/ROOT/")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(444),alt:""}})]),s._v(" "),n("ol",{attrs:{start:"3"}},[n("li",[s._v("启动服务器，使用 localhost:8080 访问")])]),s._v(" "),n("p",[s._v("ps：可以修改 tomcat 端口，查看"),n("a",{attrs:{href:"https://blog.csdn.net/qq_40180411/article/details/82112344",target:"_blank",rel:"noopener noreferrer"}},[s._v("如何修改"),n("OutboundLink")],1)]),s._v(" "),n("h3",{attrs:{id:"_1-2-问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-问题"}},[s._v("#")]),s._v(" 1.2 问题")]),s._v(" "),n("p",[s._v("当我们部署完成后，可能会出现这样的问题：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(445),alt:""}})]),s._v(" "),n("p",[s._v("原因是跨域失败。")]),s._v(" "),n("p",[s._v("在开发时，可以使用 proxy 代理来解决跨域问题：")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// config\\index.js")]),s._v("\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    dev"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        proxyTable"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/api'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                target"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://ip地址:8089/wh_mapping_server'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 部署地址")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// secure: false,  // 如果是https接口，需要配置这个参数")]),s._v("\n                changeOrigin"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 如果接口跨域，需要进行这个参数配置")]),s._v("\n                pathRewrite"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^/api'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 路径的替换规则")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// login.vue")]),s._v("\naxios"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("post")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/api/servlet/LoginServlet"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"其他参数"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("p",[s._v("在跨域访问时，以 "),n("code",[s._v("/api/servlet/loginServlet/...")]),s._v("调用，可以自动替换 "),n("code",[s._v("/api/")]),s._v("为"),n("code",[s._v("http://ip:端口/servelet/...")]),s._v("。")]),s._v(" "),n("p",[s._v("这里，proxyTable 做了两件事（参考这篇"),n("a",{attrs:{href:"https://www.cnblogs.com/wasbg/p/12659610.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("proxyTable简要叙述"),n("OutboundLink")],1),s._v("）：")]),s._v(" "),n("ol",[n("li",[s._v("替换请求接口：api -> http://ip:端口")]),s._v(" "),n("li",[s._v("提供一个代理服务器，由代理服务器去请求数据，再返回给 axios")])]),s._v(" "),n("p",[s._v("其中，第二点很重要，通过这个代理服务器，无需后端配合设置 header 直接实现跨域，这样我们就可以请求那些并非我们控制下的 api 接口。")]),s._v(" "),n("p",[s._v("这也就是为什么，如果只是手动提供端口，并不能解决跨域问题：")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// login.vue")]),s._v("\naxios"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("post")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://ip:端口/servlet/LoginServlet"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[n("img",{attrs:{src:a(446),alt:""}})]),s._v(" "),n("p",[s._v("解决办法就是我们自己在生产环境提供一个代理服务器。")]),s._v(" "),n("h2",{attrs:{id:"_2-部署到-nginx-代理服务器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-部署到-nginx-代理服务器"}},[s._v("#")]),s._v(" 2. 部署到 nginx 代理服务器")]),s._v(" "),n("h3",{attrs:{id:"_2-1-步骤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-步骤"}},[s._v("#")]),s._v(" 2.1 步骤")]),s._v(" "),n("ol",[n("li",[s._v("生成 dist 文件（同上，不多介绍）")]),s._v(" "),n("li",[s._v("将 dist 文件夹下的内容拷贝到 nginx 目录下：nginx/html\n"),n("img",{attrs:{src:a(447),alt:""}})]),s._v(" "),n("li",[s._v("配置 nginx 文件")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("server{\n\tlisten       8889;\n    server_name  localhost;\n\tlocation / {\n        root html;\n\t\tindex index.html index.htm\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("这时就可以访问项目了，不过还是没能解决跨域问题。")]),s._v(" "),n("h3",{attrs:{id:"_2-2-跨域配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-跨域配置"}},[s._v("#")]),s._v(" 2.2 跨域配置")]),s._v(" "),n("p",[s._v("我们现在的请求接口依然是以 /api 开头的链接，在 dev 模式下，我们通过 proxyTable 实现了接口的替换，在 nginx 服务器下，实现思路也类似。")]),s._v(" "),n("p",[s._v("本篇中的代理配置参考这篇文章："),n("a",{attrs:{href:"https://www.cnblogs.com/gabrielchen/p/5066120.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("用nginx的反向代理机制解决前端跨域问题"),n("OutboundLink")],1),s._v("，配置如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("server{\n    # 在上述配置后面接着写\n    location /api/ {\n        # 使用正则表达式重写 api\n\t\trewrite ^/api/(.*)$ /wh_mapping_server/$1 break;\n\t    proxy_pass http://47.96.162.249:8089; #代理的地址\n\t}\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("用例子解释下这个代理配置。")]),s._v(" "),n("p",[s._v("当请求链接为 "),n("code",[s._v("/api/servlet/loginServlet")]),s._v(" 时，匹配到这个 代理location ，正则表达式 "),n("code",[s._v("^/api/(.*)$")]),s._v(" 匹配以 "),n("code",[s._v("/api/")]),s._v("开头，以任意多项任意符号结尾的表达式，并传值给 $1 ，即当前 $1 即是 "),n("code",[s._v("servlet/loginServlet")]),s._v(" 。rewrite 之后，请求链接变成 "),n("code",[s._v("localhost:8080/wh_mapping_server/servlet/loginServlet")]),s._v(" 。")]),s._v(" "),n("p",[s._v("此时的服务器还是 ，proxy_pass 将 "),n("code",[s._v("localhost:8080")]),s._v(" 变为代理后的服务器。")]),s._v(" "),n("p",[s._v("大功告成！")]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),n("p",[s._v("修改 nginx.conf 之后，一定要使用命令 "),n("code",[s._v("nginx.exe -s reload")]),s._v(" 重启 nginx 服务器，来使修改生效。")]),s._v(" "),n("p",[s._v("否则，你就会像我一样，卡在这里半天，还在想是哪里配置得不对。")]),s._v(" "),n("p",[s._v("这里有两篇参考文章：\n- "),n("a",{attrs:{href:"https://blog.csdn.net/lzhfdxhxm/article/details/104736292/",target:"_blank",rel:"noopener noreferrer"}},[s._v("代理不生效问题"),n("OutboundLink")],1),s._v("\n- "),n("a",{attrs:{href:"https://blog.csdn.net/kung_com/article/details/95627305",target:"_blank",rel:"noopener noreferrer"}},[s._v("重启失败问题"),n("OutboundLink")],1)])]),s._v(" "),n("h3",{attrs:{id:"_2-3-问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-问题"}},[s._v("#")]),s._v(" 2.3 问题")]),s._v(" "),n("p",[s._v("我的项目路由使用的 history 模式，获得了一个好看的地址路径。但是在部署到 nginx 之后，会出现问题。")]),s._v(" "),n("p",[s._v("当刷新 localhost:8080 时，行为还算正常；可是当地址带路由时，譬如 localhost:8080/login ，就会出现问题：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(448),alt:""}})]),s._v(" "),n("p",[s._v("这个问题， "),n("code",[s._v("vue-router 官方")]),s._v(" 已经帮我们提供了"),n("a",{attrs:{href:"https://router.vuejs.org/zh/guide/essentials/history-mode.html#%E5%90%8E%E7%AB%AF%E9%85%8D%E7%BD%AE%E4%BE%8B%E5%AD%90",target:"_blank",rel:"noopener noreferrer"}},[s._v("解决方案"),n("OutboundLink")],1),s._v("，针对不同的服务器，有相应的配置说明。在nginx 下，添加一行配置：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("server{\n\tlisten       8889;\n    server_name  localhost;\n\tlocation / {\n        root html;\n        try_files $uri $uri/ /index.html;\n\t\tindex index.html index.htm\n    }\n}\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h2",{attrs:{id:"_3-将项目部署到二级目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-将项目部署到二级目录"}},[s._v("#")]),s._v(" 3. 将项目部署到二级目录")]),s._v(" "),n("p",[s._v("上述两种部署方式，都将项目丢在服务器的根目录里，通过 localhost:8080 直接访问。这样固然方便，却略显奢侈，我们的项目也不都是有资格占据主页的。")]),s._v(" "),n("p",[s._v("很多时候，需要提供一个二级目录，即 "),n("code",[s._v("localhost:8080/myprj")]),s._v(" 这种形式。")]),s._v(" "),n("h3",{attrs:{id:"_3-1-项目代码修改"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-项目代码修改"}},[s._v("#")]),s._v(" 3.1 项目代码修改")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://router.vuejs.org/zh/api/#base",target:"_blank",rel:"noopener noreferrer"}},[s._v("base 选项"),n("OutboundLink")],1),s._v("更改路由设置：")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// router/index.js")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" router "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Router")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    base"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/myprj/"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[n("a",{attrs:{href:"https://cli.vuejs.org/zh/config/#publicpath",target:"_blank",rel:"noopener noreferrer"}},[s._v("publicPath"),n("OutboundLink")],1),s._v("配置部署包：")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// config/index.js")]),s._v("\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    publicPath"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/myprj/"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h3",{attrs:{id:"_3-2-部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-部署"}},[s._v("#")]),s._v(" 3.2 部署")]),s._v(" "),n("p",[s._v("事实上，在经过上面修改之后，剩下的部署步骤与第二章的部署如出一辙。")]),s._v(" "),n("ol",[n("li",[s._v("打包：npm run build")]),s._v(" "),n("li",[s._v("拷贝")]),s._v(" "),n("li",[s._v("启动服务器")])]),s._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"custom-block-title"},[s._v("WARNING")]),s._v(" "),n("p",[s._v("这样其实不是真正的二级目录，而是假的二级目录，在设置的这个端口上依然只有这么一个服务。")]),s._v(" "),n("p",[s._v("资源，文件都在一级目录，只是通过 3.1 中的设置，使得呈现出了二级目录的效果。")]),s._v(" "),n("p",[s._v("真正实现二级目录的部署，考虑到资源路径的引用等等问题尚未解决。")])]),s._v(" "),n("h2",{attrs:{id:"附-其他坑"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#附-其他坑"}},[s._v("#")]),s._v(" 附：其他坑")]),s._v(" "),n("h3",{attrs:{id:"部署中的路径问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#部署中的路径问题"}},[s._v("#")]),s._v(" 部署中的路径问题")]),s._v(" "),n("p",[s._v("index.htm 中引入的资源，最好都放在 static 中，引入 node_modules 文件夹中的文件容易出问题。")]),s._v(" "),n("p",[s._v("引用 static 文件时，使用绝对路径 "),n("code",[s._v("/static/js/...")]),s._v("，否则容易出现强刷后加载资源失败的问题。")]),s._v(" "),n("p",[s._v("关于 assetsPublicPath ，"),n("a",{attrs:{href:"https://juejin.im/post/6844903702419996685",target:"_blank",rel:"noopener noreferrer"}},[s._v("有人"),n("OutboundLink")],1),s._v("做了一些试验，得出了以下结论：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(449),alt:""}})]),s._v(" "),n("p",[s._v("关于静态数据处理的几个博客(容后研究)：")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://blog.csdn.net/delebasou/article/details/106834620?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2.channel_param&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2.channel_param",target:"_blank",rel:"noopener noreferrer"}},[s._v("vue 配置vue.config.js 处理static文件夹下的静态文件"),n("OutboundLink")],1)])]),s._v(" "),n("h3",{attrs:{id:"资源报错问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#资源报错问题"}},[s._v("#")]),s._v(" 资源报错问题")]),s._v(" "),n("p",[n("img",{attrs:{src:a(450),alt:""}})]),s._v(" "),n("p",[s._v("经过测试，问题在于 index.html 中的路径引用有问题。")]),s._v(" "),n("div",{staticClass:"language-html line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- index.html --\x3e")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- 原文件 --\x3e")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("src")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("./static/js/lodash.min.js"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token script"}}),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- 将路径改为绝对路径即可 --\x3e")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("src")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("/static/js/lodash.min.js"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token script"}}),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h3",{attrs:{id:"正则表达式问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#正则表达式问题"}},[s._v("#")]),s._v(" 正则表达式问题")]),s._v(" "),n("p",[s._v("在文件打包时遇到如下问题：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(451),alt:""}})]),s._v(" "),n("p",[s._v("经过查询，在"),n("a",{attrs:{href:"https://stackoverflow.com/questions/29370007/regex-look-behind-invalid-regular-expression-s-invalid-group",target:"_blank",rel:"noopener noreferrer"}},[s._v("这篇问答"),n("OutboundLink")],1),s._v("里找到答案，原因在于这个"),n("code",[s._v("向后引用")]),s._v("， js 只是部分支持了这个语法，在打包时， vue 不认，所以报错。")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" png "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./abcd/1234.png"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 原想通过这种方式，获取 abcd")]),s._v("\npng"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("match")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token regex"}},[n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("(?<=(\\.\\/)).*(?=\\/)")]),n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// abcd")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 修改为了以下方式：")]),s._v("\npng"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("match")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token regex"}},[n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("(\\.\\/).*(?=\\/)")]),n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("slice")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// abcd")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h3",{attrs:{id:"无法通过ip访问"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#无法通过ip访问"}},[s._v("#")]),s._v(" 无法通过ip访问")]),s._v(" "),n("p",[s._v("部署在阿里云服务器上，可以使用 localhost 访问项目，使用 ip 地址却访问失败。")]),s._v(" "),n("p",[s._v("因为阿里云上有其他人的项目，所以也不敢轻易尝试网上提供的方式。")]),s._v(" "),n("p",[s._v("仔细看了下别人部署的项目，配置也没什么特别的，却可以轻松访问。然后我把项目端口改了个与别人相近的一个，结果……成功了。")]),s._v(" "),n("p",[s._v("大概是我原来的端口占用了什么东西吧，但是使用 localhost 却可以访问，就很神奇……")])])}),[],!1,null,null,null);t.default=e.exports}}]);