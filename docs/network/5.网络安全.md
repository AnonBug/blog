---
sidebar: auto
---
# 网络安全
## XSS 攻击
> [前端安全系列（一）：如何防止XSS攻击？——美团技术团队](https://tech.meituan.com/2018/09/27/fe-security.html)

XSS （Cross-Site Scripting 跨站脚本攻击）通常指的是通过利用网页开发时留下的漏洞，通过巧妙的方法**注入恶意指令代码到网页**，使用户加载并执行攻击者恶意制造的网页程序。

直白地讲，向页面注入恶意代码就是 XSS 攻击。攻击的类型是依靠注入方式的区别划分的。

XSS 的本质是：恶意代码未经过滤，与网站正常的代码混在一起；浏览器无法分辨哪些脚本是可信的，导致恶意脚本被执行。

由于直接在用户的终端执行，恶意代码能够直接获取用户的信息，或者利用这些信息冒充用户向网站发起攻击者定义的请求。

### 存储型 XSS 
**攻击步骤**

1. 攻击者将恶意代码提交到目标网站的数据库中。
2. 用户打开目标网站时，网站服务端将恶意代码从数据库取出，拼接在 HTML 中返回给浏览器。
3. 用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。
4. 恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

**触发条件**
这种攻击常见于<mark>带有用户保存数据的网站功能</mark>，如论坛发帖、商品评论、用户私信等。

### 反射型 XSS

**攻击步骤**

1. 攻击者构造出特殊的 URL，其中包含恶意代码。
2. 用户打开带有恶意代码的 URL 时，网站服务端将恶意代码从 URL 中取出，拼接在 HTML 中返回给浏览器。
3. 用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。
4. 恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

**触发条件**
反射型 XSS 漏洞常见于<mark>通过 URL 传递参数的功能</mark>，如网站搜索、跳转等。

<u>由于需要用户主动打开恶意的 URL 才能生效，攻击者往往会结合多种手段诱导用户点击。</u>

> **反射型 XSS 跟存储型 XSS 的区别**
> 
> 存储型 XSS 的恶意代码存在数据库里，反射型 XSS 的恶意代码存在 URL 里。

### DOM 型 XSS

**攻击步骤**

1. 攻击者构造出特殊的 URL，其中包含恶意代码。
2. 用户打开带有恶意代码的 URL。
3. 用户浏览器接收到响应后解析执行，前端 JavaScript 取出 URL 中的恶意代码并执行。
4. 恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

> **DOM 型 XSS 跟前两种 XSS 的区别**
> 
> DOM 型 XSS 攻击中，取出和执行恶意代码由浏览器端完成，属于前端 JavaScript 编写时的安全漏洞，而其他两种 XSS 都属于服务端的安全漏洞。

### 防护策略
XSS 攻击有两大要素：

- 攻击者提交恶意代码
- 浏览器执行恶意代码

对于明确的输入类型，如数字、URL 、电话号码等，可以进行输入过滤以防止攻击者提交恶意代码。

**预防存储型和反射型 XSS 攻击**

- 纯前端渲染
- HTML 转义

**预防 DOM 型 XSS 攻击**

前端 JavaScript 代码编写中：
- 避免在字符串中拼接不可信的数据
- 避免把不可信数据作为 HTML 插入到页面中

## CSRF 攻击
> [前端安全系列之二：如何防止CSRF攻击？——美团技术团队](https://segmentfault.com/a/1190000016659945)

CSRF（Cross-site request forgery，跨站请求伪造）：攻击者诱导受害者进入第三方网站，在第三方网站中，向被攻击网站发送跨站请求。利用受害者在被攻击网站已经获取的注册凭证，绕过后台的用户验证，达到冒充用户对被攻击的网站执行某项操作的目的。

攻击步骤

1. 受害者登录 `a.com`，并保留了登录凭证（Cookie）。
2. 攻击者<mark>引诱受害者</mark>访问了`b.com`。
3. `b.com` 向 `a.com` 发送了一个请求：`a.com/act=xx`。浏览器会默认携带`a.com`的 `Cookie` 。
4. `a.com`接收到请求后，对请求进行验证，并确认是受害者的凭证，误以为是受害者自己发送的请求。
5. `a.com`以受害者的名义执行了`act=xx`。
6. 攻击完成，攻击者在受害者不知情的情况下，冒充受害者，让`a.com`执行了自己定义的操作。

攻击特点

- 攻击一般发起在第三方网站，而不是被攻击的网站。被攻击的网站无法防止攻击发生。
- 攻击利用受害者在被攻击网站的登录凭证，冒充受害者提交操作；而不是直接窃取数据。
- 整个过程攻击者并不能获取到受害者的登录凭证，仅仅是“冒用”。
- 跨站请求可以用各种方式：图片URL、超链接、CORS、Form提交等等。部分请求方式可以直接嵌入在第三方论坛、文章中，难以进行追踪。

> CSRF通常是跨域的，因为外域通常更容易被攻击者掌控。但是如果本域下有容易被利用的功能，比如可以发图和链接的论坛和评论区，攻击可以直接在本域下进行，而且这种攻击更加危险

### GET 类型
```html
<img src="http://bank.example/withdraw?amount=10000&for=hacker" >
```
在受害者访问含有这个img的页面后，浏览器会自动向 `http://bank.example/withdraw?account=xiaoming&amount=10000&for=hacker` 发出一次HTTP请求。bank.example就会收到包含受害者登录信息的一次跨域请求。

### POST 类型
```html
 <form action="http://bank.example/withdraw" method=POST>
    <input type="hidden" name="account" value="xiaoming" />
    <input type="hidden" name="amount" value="10000" />
    <input type="hidden" name="for" value="hacker" />
</form>
<script> document.forms[0].submit(); </script> 
```
一种自动提交的表单，访问该页面后，表单会自动提交，相当于模拟用户完成了一次POST操作。

### 链接类型
```html
<a href="http://test.com/csrf/withdraw.php?amount=1000&for=hacker" taget="_blank">
  重磅消息！！
<a/>
```
需要用户点击链接才会触发。这种类型通常是在论坛中发布的图片中嵌入恶意链接，或者以广告的形式诱导用户中招，攻击者通常会以比较夸张的词语诱骗用户点击。

由于之前用户登录了信任的网站A，并且保存登录状态，只要用户主动访问上面的这个PHP页面，则表示攻击成功。

### 防护策略

- 阻止不明外域的访问
    - 请求头的同源检测: `Origin` / `Referer`
    - [Samesite Cookie](http://www.ruanyifeng.com/blog/2019/09/cookie-samesite.html) ：为Cookie 添加 Samesite 属性

- 提交时要求附加本域才能获取的信息
    - **CSRF Token**：
        1. 将CSRF Token输出到页面中
        2. 页面提交的请求携带这个Token
        3. 服务器验证Token是否正确
    - **双重Cookie验证**
        1. 向请求域名注入一个Cookie，内容为随机字符串
        2. 发起请求时，携带该 Cookie
        3. 后端接口验证Cookie字段与URL参数中的字段是否一致


**攻击来源**

- 攻击者自己的网站。
- 有文件上传漏洞的网站。
- 第三方论坛等用户内容。
- 被攻击网站自己的评论功能等。

**如何防止自己的网站被利用**

- 严格管理所有的上传接口，防止任何预期之外的上传内容（例如HTML）。
- 添加Header X-Content-Type-Options: nosniff 防止黑客上传HTML内容的资源（例如图片）被解析为网页。
- 对于用户上传的图片，进行转存或者校验。不要直接使用用户填写的图片链接。
- 当前用户打开其他用户填写的链接时，需告知风险（这也是很多论坛不允许直接在内容中发布外域链接的原因之一，不仅仅是为了用户留存，也有安全考虑）。

##  SQL 注入
> [举世闻名的 SQL 注入是什么？这个漫画告诉你！](https://juejin.cn/post/6936793563854274597)

SQL 注入其实就是恶意用户通过在表单中填写包含 SQL 关键字的数据来使数据库执行非常规代码的过程。

这个问题的来源是，SQL 数据库的操作是通过 SQL 语句来执行的，而无论是执行代码还是数据项都必须写在 SQL 语句之中，这就导致如果我们在数据项中加入了某些 SQL 语句关键字（比如说 SELECT、DROP 等等），这些关键字就很可能在数据库写入或读取数据时得到执行。

### 如何预防
- 尽量避免使用常见的数据库名和数据库结构
- 使用正则表达式等字符串过滤手段限制数据项的格式、字符数目

